<style>
  .location-box {
    position: relative;
  }

  .location-dropdown {
    position: absolute;
    top: 110%;
    left: 0;
    right: 0;
    background: #fff;
    border: 1px solid #ccc;
    border-radius: 6px;
    max-height: 200px;
    overflow-y: auto;
    z-index: 999;
    display: none;
  }

  .location-dropdown li {
    padding: 10px;
    cursor: pointer;
  }

  .location-dropdown li:hover {
    background: #f0f0f0;
  }
</style>


<header class="main-header">
    <div class="header-content">
        <div class="logo">
            <img src="/images/logo.png" alt="">
            <a href="/">Clasic Events Pro</a>
        </div>
        <!-- Desktop Navbar -->
        <nav class="nav-links">

          <div class="search-wrapper">
            <div class="search-box">
              <i class="fas fa-search"></i>
              <input id="desktop-search-input" type="text" placeholder="Search by title, desc, organizer" />
            </div>
            <div class="divider"></div>
            <div class="location-box">
              <i class="fas fa-map-marker-alt"></i>
              <input id="location-search-input" type="text" placeholder="Get by location" />
              <ul class="location-dropdown" id="location-suggestions"></ul>
            </div>
            <button class="search-btn">
              <i class="fas fa-sliders-h" id="location-dropdown-btn"></i>
            </button>
          </div>

          <!-- <a href="#upcoming">Live Events</a> -->
          <!-- <a href="#past">Live Radio</a> -->
          <a href="/events">Events</a>
          <a href="/services">Services</a>
          <a href="/organizers">Organizers</a>
          <a href="/promoters">Promoters</a>
          <% if( !isUserLogin ){ %>
          <a href="/signup" class="login-btn">Signup</a>
          <a href="/login" class="login-btn">Login</a>
          <% } else { %>
            <% if (isUserLogin && isUserLogin.role) { %>
              <% let profileUrl = ''; %>
              <% switch (isUserLogin.role) {
                case 'user':
                  profileUrl = `/userDashboard/${isUserLogin._id}`;
                  break;
                case 'promoter':
                  profileUrl = `/promoterDashboard/${isUserLogin._id}`;
                  break;
                case 'super-admin':
                  profileUrl = `/adminDashboard/${isUserLogin._id}`;
                  break;
                case 'vendor':
                  profileUrl = `/vendorDashboard/${isUserLogin._id}`;
                  break;
                case 'organizer':
                  profileUrl = `/organiserDashboard/${isUserLogin._id}`;
                  break;
                default:
                  profileUrl = `/userDashboard/${isUserLogin._id}`;
              } %>

              <a href="<%= profileUrl %>" class="signup-btn">
                <%= isUserLogin.username?.slice(0, 6) %>
              </a>
            <% } %>

          <a href="/logout" class="login-btn">Logout</a>
          <% } %>
        </nav>

    </div>
</header>



<div id="searchBar" class="mobile-search">
  <!-- <i class="fas fa-search"></i>  -->
  <img class="search-icon" src="https://cdn-icons-png.flaticon.com/512/54/54481.png" alt="Search">
  <div class="search-texts" onclick="focusSearch()">
    <span class="search-line1">Find things to do</span>
    <span class="search-line2" id="locationText">in kampala, ug</span>
    <input type="text" id="mobile-search-input" placeholder="" oninput="updatePlaceholder()" style="display: none;" />
    <ul class="location-dropdown" id="mobile-location-suggestions"></ul>
  </div>

  <div class="filter-btn">
    <i class="fas fa-sliders-h" id="mobile-location-dropdown-btn"></i>
  </div>

</div>


<div id="bottomNav" class="bottom-nav">
  <a href="/"><i class="fas fa-home nav-item active"></i></a>
  <i class="far fa-heart nav-item"></i>
  <i class="far fa-calendar nav-item"></i>
  <i class="far fa-comment nav-item"></i>
  <i class="fas fa-bars nav-item" onclick="toggleMenu()"></i>
</div>

<!-- Side Menu -->
<div id="sideMenu" class="side-menu">
  <div class="menu-header">
    <h3>Menu</h3>
    <i class="fas fa-times close-menu" onclick="toggleMenu()"></i>
  </div>
  <ul class="menu-list">
    <!-- <li><a href="#upcoming"><i class="fas fa-calendar-alt"></i> Live Events</a></li>
    <li><a href="#past"><i class="fas fa-radio"></i> Live Radio</a></li> -->
    <!-- <li><a href="/"><i class="fas fa-home"></i> Home</a></li>
    <li><a href="#"><i class="fas fa-info-circle"></i> About</a></li> -->
    <!-- <li><a href="#"><i class="fas fa-briefcase"></i> Careers</a></li> -->
    <li><a href="/events"><i class="fas fa-calendar"></i> Events</a></li>
    <li><a href="/services"><i class="fas fa-cogs"></i> Services</a></li>
    <li><a href="/organizers"><i class="fas fa-users"></i> Organizers</a></li>
    <li><a href="/promoters"><i class="fas fa-bullhorn"></i> Promoters</a></li>
    <li><a href="#"><i class="fas fa-star"></i> Features</a></li>
    <li><a href="#"><i class="fas fa-dollar-sign"></i> Pricing</a></li>
    <li><a href="#"><i class="fas fa-envelope"></i> Contact</a></li>


    <% if( !isUserLogin ){ %>
      <li><a href="/signup" class="login-btn"><i class="fas fa-user-plus"></i> Signup</a></li>
      <li><a href="/login" class="login-btn"><i class="fas fa-sign-in-alt"></i> Login</a></li>
    <% } else { %>
      <% if (isUserLogin && isUserLogin.role) { %>
        <% let profileUrl = ''; %>
        <% switch (isUserLogin.role) {
          case 'user':
            profileUrl = `/userDashboard/${isUserLogin._id}`;
            break;
          case 'promoter':
            profileUrl = `/promoterDashboard/${isUserLogin._id}`;
            break;
          case 'super-admin':
            profileUrl = `/adminDashboard/${isUserLogin._id}`;
            break;
          case 'vendor':
            profileUrl = `/vendorDashboard/${isUserLogin._id}`;
            break;
          case 'organizer':
            profileUrl = `/organiserDashboard/${isUserLogin._id}`;
            break;
          default:
            profileUrl = `/userDashboard/${isUserLogin._id}`;
        } %>
        <li><a href="<%= profileUrl %>" class="signup-btn"><i class="fas fa-user-circle"></i> <%= isUserLogin.username?.slice(0, 6) %></a></li>
      <% } %>
      <li><a href="/logout" class="login-btn"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
    <% } %>
  </ul>
</div>

<style>
  .bottom-nav {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: white;
    border-top: 1px solid #e0e0e0;
    display: flex;
    justify-content: space-around;
    align-items: center;
    padding: 10px 0;
    z-index: 1001;
    box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
  }

  .nav-item {
    font-size: 20px;
    color: #666;
    cursor: pointer;
    padding: 8px;
    transition: color 0.3s ease;
  }

  .nav-item.active {
    color: #cd7700;
  }

  .nav-item:hover {
    color: #cd7700;
  }

  /* Side Menu Styles - Drop from top */
  .side-menu {
    position: fixed;
    top: -120vh;
    left: 0;
    right: 0;
    width: 96%;
    margin: auto;
    margin-top: 70px;
    height: calc(100vh - 60px); /* Subtract bottom nav height */
    background: white;
    box-shadow: 2px 2px 10px rgba(0,0,0,0.1);
    transition: top 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    z-index: 1000;
    border-radius: 20px;
    overflow-y: auto;
  }

  .side-menu.active {
    top: 0;
  }

  .menu-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-top: 50px;
    padding: 20px;
    width: 100%;
    border-bottom: 1px solid #e0e0e0;
    backdrop-filter: blur(20px) saturate(160%);
    -webkit-backdrop-filter: blur(20px) saturate(160%);
    background-color: rgba(255, 255, 255, 0.4);
    color: #333;
    border-radius: 20px;
    position: sticky;
    top: 0;
    z-index: 1002;
  }

  .menu-header i{
    color: #333;
  }

  .menu-header h3 {
    margin: 0;
    color: #333;
    font-weight: 600;
  }

  .close-menu {
    font-size: 20px;
    cursor: pointer;
    color: white;
    transition: transform 0.3s ease;
  }

  .close-menu:hover {
    transform: rotate(90deg);
  }

  .menu-list {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .menu-list li {
    border-bottom: 1px solid #f0f0f0;
    opacity: 0;
    transform: translateY(20px);
    animation: slideIn 0.3s ease forwards;
  }

  .menu-list li:nth-child(1) { animation-delay: 0.1s; }
  .menu-list li:nth-child(2) { animation-delay: 0.2s; }
  .menu-list li:nth-child(3) { animation-delay: 0.3s; }
  .menu-list li:nth-child(4) { animation-delay: 0.4s; }
  .menu-list li:nth-child(5) { animation-delay: 0.5s; }
  .menu-list li:nth-child(6) { animation-delay: 0.6s; }
  .menu-list li:nth-child(7) { animation-delay: 0.7s; }
  .menu-list li:nth-child(8) { animation-delay: 0.8s; }
  .menu-list li:nth-child(9) { animation-delay: 0.9s; }
  .menu-list li:nth-child(10) { animation-delay: 1.0s; }
  .menu-list li:nth-child(11) { animation-delay: 1.1s; }
  .menu-list li:nth-child(12) { animation-delay: 1.2s; }
  .menu-list li:nth-child(13) { animation-delay: 1.3s; }
  .menu-list li:nth-child(14) { animation-delay: 1.4s; }

  @keyframes slideIn {
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .menu-list li a {
    display: flex;
    align-items: center;
    padding: 18px 20px;
    color: #333;
    text-decoration: none;
    transition: all 0.3s ease;
    font-weight: 500;
  }

  .menu-list li a:hover {
    background: linear-gradient(90deg, #f8f9fa, #e9ecef);
    color: #007bff;
    padding-left: 25px;
  }

  .menu-list li a i {
    margin-right: 15px;
    width: 20px;
    font-size: 16px;
  }

  .menu-list li a.login-btn {
    color: #007bff;
    font-weight: 600;
  }

  .menu-list li a.signup-btn {
    color: #28a745;
    font-weight: 600;
  }

  /* Hide on desktop */
  @media (min-width: 768px) {
    .bottom-nav {
      display: none;
    }
  }
</style>

<script>
  function toggleMenu() {
    const sideMenu = document.getElementById('sideMenu');
    sideMenu.classList.toggle('active');
  }

  // Handle navigation item clicks
  document.addEventListener('DOMContentLoaded', function() {
    const navItems = document.querySelectorAll('.nav-item');

    navItems.forEach(item => {
      item.addEventListener('click', function() {
        // Remove active class from all items
        navItems.forEach(nav => nav.classList.remove('active'));
        // Add active class to clicked item
        this.classList.add('active');
      });
    });

    // Close menu when clicking outside
    document.addEventListener('click', function(event) {
      const sideMenu = document.getElementById('sideMenu');
      const menuButton = document.querySelector('.fas.fa-bars');
      // Check if click is outside the menu and not on the menu button
      if (sideMenu && !sideMenu.contains(event.target) && !menuButton.contains(event.target)) {
        sideMenu.classList.remove('active');
      }
    });
  });
</script>









<div id="results" class="search-results"></div>


<script>
  async function loadLocations() {
    try {
      const res = await fetch('/locations');
      return await res.json();
    } catch (err) {
      console.error('Error fetching locations:', err);
      return [];
    }
  }

  async function searchByLocation(query) {
    const resultsContainer = document.getElementById('results');
    resultsContainer.innerHTML = '<p>Loading events for location...</p>';

    try {
      const res = await fetch(`/search/location?query=${encodeURIComponent(query)}`);
      const html = await res.text();
      resultsContainer.innerHTML = html;
    } catch (err) {
      resultsContainer.innerHTML = '<p>Failed to load events.</p>';
    }
  }

  document.addEventListener('DOMContentLoaded', async () => {
    const locations = await loadLocations();

    // Desktop Elements
    const locationBtn = document.getElementById('location-dropdown-btn');
    const locationInput = document.getElementById('location-search-input');
    const suggestionBox = document.getElementById('location-suggestions');

    // Mobile Elements
    const mobileBtn = document.getElementById('mobile-location-dropdown-btn');
    const mobileInput = document.getElementById('mobile-search-input');
    const mobileSuggestions = document.getElementById('mobile-location-suggestions');

    function populateSuggestions(locations, input, dropdown) {
      dropdown.innerHTML = '';
      locations.forEach(loc => {
        const li = document.createElement('li');
        li.textContent = loc;
        li.addEventListener('click', () => {
          input.value = loc;
          dropdown.style.display = 'none';
          searchByLocation(loc);
        });
        dropdown.appendChild(li);
      });
      dropdown.style.display = 'block';
    }

    locationBtn.addEventListener('click', () => {
      populateSuggestions(locations, locationInput, suggestionBox);
    });

    mobileBtn.addEventListener('click', () => {
      populateSuggestions(locations, mobileInput, mobileSuggestions);
    });

    document.addEventListener('click', (e) => {
      if (!locationBtn.contains(e.target) &&
          !locationInput.contains(e.target) &&
          !suggestionBox.contains(e.target)) {
        suggestionBox.style.display = 'none';
      }
      if (!mobileBtn.contains(e.target) &&
          !mobileInput.contains(e.target) &&
          !mobileSuggestions.contains(e.target)) {
        mobileSuggestions.style.display = 'none';
      }
    });
  });
</script>
