<%-include("../partials/header") %>

<%-include("../partials/dropdown") %>

<%-include("../partials/flash") %>



  <div style="background-image: url('<%= blog.image %>');" class="hero">
    <h1><%= blog.title.charAt(0).toUpperCase() + blog.title.slice(1) %></h1>
  </div>

  <div class="container">

    <div class="info">
      <h2>Event Details</h2>

      <p><strong>Created On:</strong> <%= new Date(blog.createdAt).toDateString() %></p>
      <p><strong>Created By:</strong> <%= blog.publisher.username %></p>

      <% if (blog.category) { %>
        <div class="tags">
          <span class="tag"><%= blog.category.charAt(0).toUpperCase() + blog.category.slice(1) %></span>
        </div>
      <% } %>

      <p><%= blog.content %></p>

      <div class="actions">
        <% if (String(blog.user) === userId) { %>
           <p style="margin-top: 20px">
           <a href="/editBlog/<%= blog._id %>" class="btn btn-warning">Edit</a>
           <a href="/deleteBlog/<%= blog._id %>" class="btn btn-warning">Delete</a>
           </p>
        <% } %>
      </div>

    </div>

    <div class="ticket-section">
      <div class="event-header">
        <h2>You may likes these Events</h2>
      </div>

      <div class="profile-grid-events">

        <% events.forEach(event => { %>
          <div class="profile-card">
            <img src="<%= event.image || 'https://via.placeholder.com/400x250' %>" alt="<%= event.title %>" class="profile-image" />

            <div class="button-row">
              <!-- Profile image -->
              <div class="profile-img">
                <img src="https://via.placeholder.com/40" alt="Profile">
              </div>

              <!-- Stats: views, likes, shares -->
              <div class="right-buttons">
                <div class="stat">
                  <div class="stat-count">1.2k</div>
                  <i class="fa-solid fa-eye stat-icon"></i>
                </div>

                <div class="stat" onclick="toggleLike(this)">
                  <div class="stat-count" id="likeCount"><%= event.views %></div>
                  <i class="fa-regular fa-heart stat-icon heart"></i>
                </div>

                <div class="stat">
                  <div class="stat-count">89</div>
                  <i class="fa-solid fa-share stat-icon"></i>
                </div>
              </div>
            </div>

            <div class="card-body">
              <h3><%= event.title?.slice(0, 55) %>....</h3>
              <p>ğŸ“… <%= new Date(event.date).toDateString() %> |
                <i style="font-size: 14px; margin-left: 5px;" class="fa fa-map-marker" aria-hidden="true"></i>
                <%= event.location %>
              </p>

              <% if (event.is_free) { %>
                <p>ğŸŸï¸ Free</p>
              <% } else {
                  const cheapest = event.ticket_types.reduce((min, ticket) => ticket.current_price < min ? ticket.current_price : min, event.ticket_types[0].current_price);
                  const totalSold = event.ticket_types.reduce((sum, ticket) => sum + ticket.sold, 0);
                  const totalAvailable = event.ticket_types.reduce((sum, ticket) => sum + ticket.total_available, 0);
                  const ticketsLeft = totalAvailable - totalSold;
              %>
                <p>ğŸ’¸ From $<%= cheapest %> | ğŸ”¥ Only <%= ticketsLeft %> left</p>
              <% } %>

              <div class="actionbtn">
                <a class="bookingbtn" href="/book/event/<%= event._id %>">Book ticket</a>
                <a class="detailsbtn" href="/show/<%= event.type %>/<%= event._id %>">View details</a>
              </div>
            </div>
          </div>
        <% }); %>
      </div>

    </div>


    </div>
  </div>

  <%-include("../partials/footer") %>
