<%-include("../partials/header") %>

<%-include("../partials/dropdown") %>

<%-include("../partials/flash") %>

<%-include(".././events/slide") %>


<% blogs.reverse() %>
<% if (blogs.length > 0) { %>

  <div class="blog-grid">
    <% blogs.forEach(blog => { %>
      <div class="blog-card">
        <img src="<%= blog.image %>" alt="<%= blog.username %>">
        <h4><%= blog.title %></h4>
        <a href="/more/<%= blog._id %>"><button class="follow-btn">Learn more</button></a>
      </div>
    <% }); %>
  </div>

 <% } else { %>
 <p style="text-align:center; font-size:1em; margin-top: 25px; margin-bottom: 70px">No Blog found now, please come back later.</p>
 <% } %>


 <section class="section" data-tags="tomorrow, this-weekend, this-month, next-month, online, today">

   <div class="section-header">
     <h2>Trendings Blogs</h2>
   </div>

   <div class="trending-events">
     <% blogs.forEach(blog => { %>
       <div class="trending-card">
         <img src="<%= blog.image || 'https://via.placeholder.com/400x250' %>" alt="<%= blog.title %>" />

         <div class="card-body">
           <h3><%= blog.title?.slice(0, 25) %>....</h3>
           <p><%= blog.content?.slice(0, 80) %>...</p>
           <a href="/more/<%= blog._id %>"><button class="follow-btn">Learn more</button></a>
         </div>
       </div>
     <% }); %>
   </div>
 </section>




 <section>

   <div class="section-header">
     <h2>Events You May like</h2>
   </div>

   <div class="events" id="eventScroll">
     <% events.forEach(event => { %>
       <div class="card">
         <img src="<%= event.image || 'https://via.placeholder.com/400x250' %>" alt="<%= event.title %>" />

         <div class="button-row">
           <!-- Profile image -->
           <div class="profile-img">
             <img src="https://via.placeholder.com/40" alt="Profile">
           </div>

           <!-- Stats: views, likes, shares -->
           <div class="right-buttons">
             <div class="stat">
               <div class="stat-count">1.2k</div>
               <i class="fa-solid fa-eye stat-icon"></i>
             </div>

             <div class="stat" onclick="toggleLike(this)">
               <div class="stat-count" id="likeCount"><%= event.views %></div>
               <i class="fa-regular fa-heart stat-icon heart"></i>
             </div>

             <div class="stat">
               <div class="stat-count">89</div>
               <i class="fa-solid fa-share stat-icon"></i>
             </div>
           </div>
         </div>

         <div class="card-body">
           <h3><%= event.title?.slice(0, 55) %>....</h3>
           <p>📅 <%= new Date(event.date).toDateString() %> | <i style="font-size: 14px; margin-left: 5px;" class="fa fa-map-marker" aria-hidden="true"></i> <%= event.location %></p>

           <% if (event.is_free) { %>
             <p>🎟️ Free</p>
           <% } else {
               const cheapest = event.ticket_types.reduce((min, ticket) => ticket.current_price < min ? ticket.current_price : min, event.ticket_types[0].current_price);
               const totalSold = event.ticket_types.reduce((sum, ticket) => sum + ticket.sold, 0);
               const totalAvailable = event.ticket_types.reduce((sum, ticket) => sum + ticket.total_available, 0);
               const ticketsLeft = totalAvailable - totalSold;
           %>
             <p>💸 From $<%= cheapest %> | 🔥 Only <%= ticketsLeft %> left</p>
           <% } %>

           <div class="actionbtn">
             <a class="bookingbtn" href="/book/event/<%= event._id %>">Book ticket</a>
             <a class="detailsbtn" href="/show/<%= event.type %>/<%= event._id %>">View details</a>
           </div>
         </div>
       </div>
     <% }); %>
   </div>

   <!-- <button class="scroll-button left" id="prevBtn">‹</button>

   <button class="scroll-button right" id="nextBtn">›</button> -->

 </section>



<%-include("../partials/footer") %>
