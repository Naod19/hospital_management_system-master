<%-include("../partials/header") %>

<%-include("../partials/dropdown") %>

<%-include("../partials/flash") %>

<div class="svc-form-container">
  <h2>Edit Service</h2>
  <form class="svc-form" action="/editService/<%= service._id %>" method="POST" enctype="multipart/form-data">

    <!-- COMMON FIELDS -->
    <div>
      <label for="svc_name">Service Name</label>
      <input type="text" name="name" id="svc_name" value="<%= service.name %>" required />
    </div>

    <div>
      <label for="svc_location">Location</label>
      <input type="text" name="location" id="svc_location" value="<%= service.location %>">
    </div>

    <div>
      <label for="svc_phone">Phone</label>
      <input type="text" name="phone" id="svc_phone" value="<%= service.phone %>">
    </div>

    <div>
      <label for="svc_email">Email</label>
      <input type="email" name="email" id="svc_email" value="<%= service.email %>">
    </div>

    <div>
      <label for="svc_images">Service Images</label>
      <input type="file" name="images" id="svc_images" multiple>
    </div>

    <div>
      <label for="svc_category">Category</label>
      <select name="category" id="svc_category" required>
        <option value="">-- Select Type --</option>
        <% const categories = ['hotel','car','eventhall','photographer','decorator','caterer','dj','makeup_artist']; %>
        <% categories.forEach(cat => { %>
          <option value="<%= cat %>" <%= service.category===cat?'selected':'' %>><%= cat.charAt(0).toUpperCase()+cat.slice(1).replace('_',' ') %></option>
        <% }) %>
      </select>
    </div>

    <!-- EXTRA FIELDS PER CATEGORY -->
    <% /* Hotel Fields */ %>
    <div class="svc-extra-group" id="svc_hotel">
      <div><label>Price per Night</label><input type="number" name="price_per_night" value="<%= service.price_per_night || '' %>"></div>
      <div><label>Amenities</label><input type="text" name="amenities" value="<%= service.amenities || '' %>"></div>
      <div><label>Check-in Time</label><input type="time" name="check_in_time" value="<%= service.check_in_time || '' %>"></div>
      <div><label>Check-out Time</label><input type="time" name="check_out_time" value="<%= service.check_out_time || '' %>"></div>
    </div>

    <% /* Car Fields */ %>
    <div class="svc-extra-group" id="svc_car">
      <div><label>Brand</label><input type="text" name="brand" value="<%= service.brand || '' %>"></div>
      <div><label>Model</label><input type="text" name="model" value="<%= service.model || '' %>"></div>
      <div><label>Features</label><input type="text" name="features" value="<%= service.features || '' %>"></div>
      <div><label>Price Per Day</label><input type="number" name="rent_per_day" value="<%= service.rent_per_day || '' %>"></div>
      <div><label>Seats</label><input type="number" name="seating_capacity" value="<%= service.seating_capacity || '' %>"></div>
      <div>
        <label>Transmission</label>
        <select name="transmission">
          <option value="Automatic" <%= service.transmission==='Automatic'?'selected':'' %>>Automatic</option>
          <option value="Manual" <%= service.transmission==='Manual'?'selected':'' %>>Manual</option>
        </select>
      </div>
      <div>
        <label>Fuel Type</label>
        <select name="fuel_type">
          <option value="Petrol" <%= service.fuel_type==='Petrol'?'selected':'' %>>Petrol</option>
          <option value="Diesel" <%= service.fuel_type==='Diesel'?'selected':'' %>>Diesel</option>
          <option value="Electric" <%= service.fuel_type==='Electric'?'selected':'' %>>Electric</option>
        </select>
      </div>
      <div><label><input type="checkbox" name="air_conditioning" <%= service.air_conditioning?'checked':'' %>> Air Conditioning</label></div>
    </div>

    <% /* Event Hall Fields */ %>
    <div class="svc-extra-group" id="svc_eventhall">
      <div><label>Capacity</label><input type="number" name="capacity" value="<%= service.capacity || '' %>"></div>
      <div><label>Price per Hour</label><input type="number" name="price_per_hour" value="<%= service.price_per_hour || '' %>"></div>
      <div><label>Facilities</label><input type="text" name="facilities" value="<%= service.facilities || '' %>"></div>
    </div>

    <% /* Photographer Fields */ %>
    <div class="svc-extra-group" id="svc_photographer">
      <div><label>Specialty</label><input type="text" name="photographer_specialties" value="<%= service.photographer_specialties || '' %>"></div>
      <div><label>Price per Session</label><input type="number" name="photographer_price" value="<%= service.photographer_price || '' %>"></div>
      <div><label>Experience (Years)</label><input type="number" name="photographer_years" value="<%= service.photographer_years || '' %>"></div>
      <div><label>Portfolio Link</label><input type="text" name="photographer_portfolio" value="<%= service.photographer_portfolio || '' %>"></div>
    </div>

    <% /* Decorator Fields */ %>
    <div class="svc-extra-group" id="svc_decorator">
      <div><label>Services Offered</label><input type="text" name="services_offered" value="<%= service.services_offered || '' %>"></div>
      <div><label>Price Range</label><input type="text" name="decorator_price" value="<%= service.decorator_price || '' %>"></div>
      <div><label>Experience (Years)</label><input type="number" name="decorator_years" value="<%= service.decorator_years || '' %>"></div>
      <div><label>Portfolio Link</label><input type="text" name="portfolio" value="<%= service.portfolio || '' %>"></div>
    </div>

    <% /* Caterer Fields */ %>
    <div class="svc-extra-group" id="svc_caterer">
      <div><label>Cuisine Specialties</label><input type="text" name="cuisine_types" value="<%= service.cuisine_types || '' %>"></div>
      <div><label>Price Per Plate</label><input type="number" name="price_per_plate" value="<%= service.price_per_plate || '' %>"></div>
      <div><label>Minimum Order</label><input type="number" name="minimum_order" value="<%= service.minimum_order || '' %>"></div>
      <div><label>Packages</label><textarea name="packages"><%= service.packages || '' %></textarea></div>
      <div><label><input type="checkbox" name="vegetarian" <%= service.vegetarian?'checked':'' %>> Vegetarian Options</label></div>
      <div><label><input type="checkbox" name="halal" <%= service.halal?'checked':'' %>> Halal Options</label></div>
      <div><label>Menu Link</label><input type="url" name="menu_items" value="<%= service.menu_items || '' %>"></div>
    </div>

    <% /* DJ Fields */ %>
    <div class="svc-extra-group" id="svc_dj">
      <div><label>Music Genre</label><input type="text" name="dj_genres" value="<%= service.dj_genres || '' %>"></div>
      <div><label>Hourly Rate</label><input type="number" name="dj_price" value="<%= service.dj_price || '' %>"></div>
      <div><label>Equipment</label><input type="text" name="dj_equipment" value="<%= service.dj_equipment || '' %>"></div>
      <div><label>Experience Years</label><input type="number" name="dj_years" value="<%= service.dj_years || '' %>"></div>
      <div><label>Website / Mix</label><input type="url" name="dj_link" value="<%= service.dj_link || '' %>"></div>
    </div>

    <% /* Makeup Artist Fields */ %>
    <div class="svc-extra-group" id="svc_makeup_artist">
      <div><label>Specialty</label><input type="text" name="makeup_specialties" value="<%= service.makeup_specialties || '' %>"></div>
      <div><label>Packages</label><textarea name="makeup_packages"><%= service.makeup_packages || '' %></textarea></div>
      <div><label>Price Range</label><input type="text" name="makeup_price" value="<%= service.makeup_price || '' %>"></div>
      <div><label>Experience</label><input type="number" name="makeup_years" value="<%= service.makeup_years || '' %>"></div>
      <div><label>Portfolio</label><input type="url" name="makeup_link" value="<%= service.makeup_link || '' %>"></div>
    </div>

    <button type="submit" class="svc-submit-btn">Update Service</button>

  </form>
</div>

<script>
const svcTypeSelect = document.getElementById('svc_category');
const svcFields = {
  hotel: document.getElementById('svc_hotel'),
  car: document.getElementById('svc_car'),
  eventhall: document.getElementById('svc_eventhall'),
  photographer: document.getElementById('svc_photographer'),
  decorator: document.getElementById('svc_decorator'),
  caterer: document.getElementById('svc_caterer'),
  dj: document.getElementById('svc_dj'),
  makeup_artist: document.getElementById('svc_makeup_artist')
};

function svcToggleExtraFields() {
  const selected = svcTypeSelect.value;
  Object.keys(svcFields).forEach(type => {
    if(svcFields[type]) svcFields[type].style.display = (type === selected) ? 'block' : 'none';
  });
}

document.addEventListener('DOMContentLoaded', svcToggleExtraFields);
svcTypeSelect.addEventListener('change', svcToggleExtraFields);
</script>

<%-include("../partials/footer") %>
