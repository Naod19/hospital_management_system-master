<!-- views/editEvent.ejs -->
<%-include("../partials/header") %>

<%-include("../partials/dropdown") %>

<%-include("../partials/flash") %>


<% if (event.image) { %>
  <div style="background-image: url('<%= event.image %>');" class="hero">

  </div>
<% } %>

  <form action="/update/<%= event._id %>" method="POST" enctype="multipart/form-data">
    <div class="event-edit-form-wrapper">
      <!-- Event Details Section -->
      <div class="event-edit-section">
        <h3>Event Details</h3>

        <label class="event-edit-label">Title</label>
        <input type="text" name="title" class="event-edit-input" value="<%= event.title %>" required>

        <label class="event-edit-label">Description</label>
        <textarea name="description" class="event-edit-textarea"><%= event.description %></textarea>

        <label class="event-edit-label">Category</label>
        <select name="category" class="event-edit-select">
          <option value="music" <%= event.category === 'music' ? 'selected' : '' %>>Music</option>
          <option value="fashion" <%= event.category === 'fashion' ? 'selected' : '' %>>Fashion</option>
          <option value="sports" <%= event.category === 'sports' ? 'selected' : '' %>>Sports</option>
          <option value="business" <%= event.category === 'business' ? 'selected' : '' %>>Business</option>
          <option value="education" <%= event.category === 'education' ? 'selected' : '' %>>Education</option>
          <option value="religion" <%= event.category === 'religion' ? 'selected' : '' %>>Religion</option>
          <option value="others" <%= event.category === 'others' ? 'selected' : '' %>>Others</option>
        </select>

        <label class="event-edit-label">Date</label>
        <input type="date" name="date" class="event-edit-input" value="<%= event.date.toISOString().split('T')[0] %>">

        <label class="event-edit-label">Time</label>
        <input type="time" name="time" class="event-edit-input" value="<%= event.date.toISOString().split('T')[1].slice(0,5) %>">

        <label class="event-edit-label">Location</label>
        <input type="text" name="location" class="event-edit-input" value="<%= event.location %>">

        <label class="event-edit-label">Image</label>
        <input type="file" name="image" class="event-edit-input">

      </div>

      <!-- Ticket Section -->
      <div class="event-edit-section">
        <h3>Ticket Information</h3>

        <label class="event-edit-label"><input type="checkbox" name="is_free" id="is_free" <%= event.is_free ? 'checked' : '' %>> Free Event</label>

        <div class="ticket-fields">
          <label class="event-edit-label">Ordinary Ticket Price</label>
          <input type="number" name="ordinary_price" id="ordinary_price" class="event-edit-input" value="<%= ordinary?.initial_price || '' %>">

          <label class="event-edit-label">Ordinary Total Available</label>
          <input type="number" name="ordinary_total" class="event-edit-input" value="<%= ordinary?.total_available || '' %>">

          <label class="event-edit-label">VIP Ticket Price</label>
          <input type="number" name="vip_price" id="vip_price" class="event-edit-input" value="<%= vip?.initial_price || '' %>">

          <label class="event-edit-label">VIP Total Available</label>
          <input type="number" name="vip_total" class="event-edit-input" value="<%= vip?.total_available || '' %>">

          <label class="event-edit-label">Table Ticket Price</label>
          <input type="number" name="table_price" id="table_price" class="event-edit-input" value="<%= table?.initial_price || '' %>">

          <label class="event-edit-label">Table Total Available</label>
          <input type="number" name="table_total" class="event-edit-input" value="<%= table?.total_available || '' %>">
        </div>

        <button class="event-edit-submit-btn">Update Event</button>

      </div>


    </div>

  </form>

  <script>
    const isFree = document.getElementById('is_free');
    const ticketInputs = document.querySelectorAll('.ticket-fields input[type="number"]');

    function toggleTicketInputs() {
      ticketInputs.forEach(input => input.disabled = isFree.checked);
    }

    isFree.addEventListener('change', toggleTicketInputs);
    toggleTicketInputs();
  </script>


  <%-include("../partials/footer") %>
