<%-include("../partials/header") %>

<%-include("../partials/dropdown") %>

<%-include("../partials/flash") %>


  <div style="background-image: url('<%= service.images %>');" class="hero">
    <h1><%= service.name.charAt(0).toUpperCase() + service.name.slice(1) %></h1>
  </div>

  <div class="container">
    <div class="info">
      <h2>Event Details</h2>

      <p><strong>Location:</strong> <%= service.location %></p>

      <p><strong>Contact:</strong> <%= service.phone %></p>

      <% if (service.category) { %>
        <div class="tags">
          <span class="tag"><%= service.category.charAt(0).toUpperCase() + service.category.slice(1) %></span>
        </div>
      <% } %>

      <p><%= service.description %></p>

      <div class="actions">
        <% if (user && user._id.toString() === service.created_by._id.toString()) { %>
          <!-- Owner View -->
          <button onclick="navigator.share ? navigator.share({ title: '<%= service.name %>', url: window.location.href }) : alert('Share not supported')">Share</button>
          <a href="/promotItem/<%= service.type %>/<%= service._id %>"><button>promote Event</button></a>
          <a href="/editService/<%= service._id %>"><button>Edit</button></a>
          <a href="/deleteService/<%= service._id %>"><button type="submit" onclick="return confirm('Are you sure you want to delete this event?')">Delete</button></a>
        <% } else { %>

          <!-- Correct "Book Now" button -->
          <% if (type === 'event') { %>
            <a href="/book/event/<%= event._id %>"><button>Book Now</button></a>

          <% } else if (type === 'service') { %>
            <a href="/book/service/<%= service._id %>"><button>Book Now service</button></a>
          <% } %>

        <% } %>
      </div>



      <!-- <div class="profile-grid">
        <div class="profile-card">
          <h4>Artist</h4>
          <p>Dr. Bol Deng</p>
          <p>Afrobeat Performer</p>
        </div>
        <div class="profile-card">
          <h4>Speaker</h4>
          <p>Nyamal Ruach</p>
          <p>Cultural Historian</p>
        </div>
      </div> -->

      <div class="faq">
        <h3>FAQs</h3>
        <p><strong>What should I bring?</strong> A printed or digital ticket and a valid ID.</p>
        <p><strong>Are kids allowed?</strong> Yes, under adult supervision.</p>
      </div>


      <div class="map">
        <iframe width="100%" height="250" style="border-radius: 10px" loading="lazy" allowfullscreen src="https://www.google.com/maps?q=<%= encodeURIComponent(service.location) %>&output=embed"></iframe>
      </div>

      <!-- <div class="profile-grid">
        <div class="profile-card">
          <h4>Artist</h4>
          <p>Dr. Bol Deng</p>
          <p>Afrobeat Performer</p>
        </div>
        <div class="profile-card">
          <h4>Speaker</h4>
          <p>Nyamal Ruach</p>
          <p>Cultural Historian</p>
        </div>
      </div> -->

    </div>

    <style>

  .detail {
    margin-bottom: 10px;
  }
  .label {
    font-weight: bold;
    line-height: 2.5;
    margin-left: 5px
  }
  .amenities, .features, .packages {
    background: #f0f0f0;
    padding: 8px;
    border-radius: 5px;
  }
</style>

    <div class="ticket-section">

      <!-- Hotel -->
      <% if (service.category === 'hotel') { %>
        <h2>Hotel Details</h2>
        <p><span class="label">Price per Night:</span> $<%= service.price_per_night %></p>
        <p><span class="label">Amenities:</span> <span class="amenities"><%= service.amenities %></span></p>
        <p><span class="label">Check-in Time:</span> <%= service.check_in_time %></p>
        <p><span class="label">Check-out Time:</span> <%= service.check_out_time %></p>
      <% } %>

      <!-- Car -->
      <% if (service.category === 'car') { %>
        <h2>Car Details</h2>
        <p><span class="label">Brand:</span> <%= service.brand %></p>
        <p><span class="label">Model:</span> <%= service.model %></p>
        <p><span class="label">Features:</span> <span class="features"><%= service.features %></span></p>
        <p><span class="label">Price Per Day:</span> $<%= service.rent_per_day %></p>
        <p><span class="label">Seating Capacity:</span> <%= service.seating_capacity %></p>
        <p><span class="label">Transmission:</span> <%= service.transmission %></p>
        <p><span class="label">Fuel Type:</span> <%= service.fuel_type %></p>
        <p><span class="label">Air Conditioning:</span> <%= service.air_conditioning ? 'Yes' : 'No' %></p>
      <% } %>

      <!-- Event Hall -->
      <% if (service.category === 'eventhall') { %>
        <h2>Event Hall Details</h2>
        <p><span class="label">Capacity:</span> <%= service.capacity %></p>
        <p><span class="label">Price Per Day:</span> $<%= service.price_per_day %></p>
        <p><span class="label">Facilities:</span> <span class="features"><%= service.facilities %></span></p>
      <% } %>

      <!-- Photographer -->
      <% if (service.category === 'photographer') { %>
        <h2>Photographer Details</h2>
        <p><span class="label">Specialty:</span> <%= service.photographer_specialties %></p>
        <p><span class="label">Price Per Session:</span> $<%= service.photographer_price %></p>
        <p><span class="label">Experience:</span> <%= service.photographer_years %> years</p>
        <p><span class="label">Portfolio:</span> <a href="<%= service.photographer_portfolio %>" target="_blank">View</a></p>
      <% } %>

      <!-- Decorator -->
      <% if (service.category === 'decorator') { %>
        <h2>Decorator Details</h2>
        <p><span class="label">Services Offered:</span> <%= service.services_offered %></p>
        <p><span class="label">Price Range:</span> <%= service.decorator_price %></p>
        <p><span class="label">Experience:</span> <%= service.decorator_years %> years</p>
        <p><span class="label">Portfolio:</span> <a href="<%= service.portfolio %>" target="_blank">View</a></p>
      <% } %>

      <!-- Caterer -->
      <% if (service.category === 'caterer') { %>
        <h2>Caterer Details</h2>
        <p><span class="label">Cuisine Types:</span> <%= service.cuisine_types %></p>
        <p><span class="label">Price Per Plate:</span> $<%= service.price_per_plate %></p>
        <p><span class="label">Minimum Order:</span> <%= service.minimum_order %></p>
        <p><span class="label">Packages:</span> <span class="packages"><%= service.packages %></span></p>
        <p><span class="label">Vegetarian Options:</span> <%= service.vegetarian ? 'Yes' : 'No' %></p>
        <p><span class="label">Halal Options:</span> <%= service.halal ? 'Yes' : 'No' %></p>
        <p><span class="label">Menu:</span> <a href="<%= service.menu_items %>" target="_blank">View</a></p>
      <% } %>

      <!-- DJ -->
      <% if (service.category === 'dj') { %>
        <h2>DJ Details</h2>
        <p><span class="label">Genres:</span> <%= service.dj_genres %></p>
        <p><span class="label">Hourly Rate:</span> $<%= service.dj_price %></p>
        <p><span class="label">Equipment:</span> <%= service.dj_equipment %></p>
        <p><span class="label">Experience:</span> <%= service.dj_years %> years</p>
        <p><span class="label">Music Link:</span> <a href="<%= service.dj_link %>" target="_blank">Listen</a></p>
      <% } %>

      <!-- Makeup Artist -->
      <% if (service.category === 'makeup_artist') { %>
        <h2>Makeup Artist Details</h2>
        <p><span class="label">Specialty:</span> <%= service.makeup_specialties %></p>
        <p><span class="label">Packages:</span> <span class="packages"><%= service.makeup_packages %></span></p>
        <p><span class="label">Price Range:</span> <%= service.makeup_price %></p>
        <p><span class="label">Experience:</span> <%= service.makeup_years %> years</p>
        <p><span class="label">Portfolio:</span> <a href="<%= service.makeup_link %>" target="_blank">View</a></p>
        <p><span class="label">Description:</span> <%= service.description %></p>
      <% } %>

      <% const ratingValue = existingRating ? parseInt(existingRating.rating || 0) : 0; %>

      <div class="rating-card">
        <h2><%= existingRating && existingRating._id ? 'Edit Your Rating' : 'Rate This Event' %></h2>
        <form action="/rateService/<%= service._id %>" method="POST" id="ratingForm">
          <div class="stars" id="starRating">
            <% for (let i = 1; i <= 5; i++) { %>
              <span
                class="star <%= i <= ratingValue ? 'selected' : '' %>"
                data-value="<%= i %>">&#9733;</span>
            <% } %>
          </div>

          <input type="hidden" name="rating" id="ratingValue" value="<%= ratingValue %>">
          <textarea
            name="comment"
            id="feedback"
            rows="4"
            placeholder="Tell us what you think..."
            required><%= existingRating && existingRating.comment ? existingRating.comment : '' %></textarea>

          <button class="btn" type="submit">
            <%= existingRating && existingRating._id ? 'Update Rating' : 'Submit Rating' %>
          </button>
        </form>
      </div>

      <script>
        const stars = document.querySelectorAll('.star');
        const ratingInput = document.getElementById('ratingValue');

        stars.forEach(star => {
          star.addEventListener('click', () => {
            const value = parseInt(star.getAttribute('data-value'));
            ratingInput.value = value;

            stars.forEach(s => {
              const sVal = parseInt(s.getAttribute('data-value'));
              s.classList.toggle('selected', sVal <= value);
            });
          });
        });

      </script>

      <style>
        .star {
          font-size: 24px;
          cursor: pointer;
          color: gray;
          transition: color 0.2s ease;
        }
        .star.selected {
          color: gold;
        }
      </style>

      <div class="rating-card">
        <div class="average-rating">
          <% const fullStars = Math.floor(averageRating); %>
          <% const halfStar = averageRating % 1 >= 0.5; %>
          <% const emptyStars = 5 - fullStars - (halfStar ? 1 : 0); %>

          <% for (let i = 0; i < fullStars; i++) { %>⭐<% } %>
          <% if (halfStar) { %>✬<% } %>
          <% for (let i = 0; i < emptyStars; i++) { %>☆<% } %>

          <span><%= averageRating.toFixed(1) %> out of 5</span>
        </div>

        <h3>User Reviews</h3>
        <ul class="review-list" id="reviewList">
          <% if (reviews && reviews.length > 0) { %>
            <% reviews.forEach(review => { %>
              <li class="review-item">
                <div class="name"><%= review.userName %></div>
                <div><%= review.comment %></div>
              </li>
            <% }); %>
          <% } else { %>
            <li class="review-item">
              <div>No reviews yet. Be the first to leave a comment!</div>
            </li>
          <% } %>
        </ul>
      </div>

      <!-- <div class="profile-grid">
        <div class="profile-card">
          <h4>Artist</h4>
          <p>Dr. Bol Deng</p>
          <p>Afrobeat Performer</p>
        </div>
        <div class="profile-card">
          <h4>Speaker</h4>
          <p>Nyamal Ruach</p>
          <p>Cultural Historian</p>
        </div>
      </div> -->
    </div>

    <script>
      const stars = document.querySelectorAll('.star');
      let selectedRating = 0;

      stars.forEach(star => {
        star.addEventListener('click', () => {
          selectedRating = star.dataset.value;
          updateStars(selectedRating);
        });

        star.addEventListener('mouseover', () => {
          updateStars(star.dataset.value, true);
        });

        star.addEventListener('mouseout', () => {
          updateStars(selectedRating);
        });
      });

      function updateStars(value, isHover = false) {
        stars.forEach(star => {
          star.classList.remove('selected', 'hover');
          if (star.dataset.value <= value) {
            star.classList.add(isHover ? 'hover' : 'selected');
          }
        });
      }

      function submitRating() {
        const feedback = document.getElementById('feedback').value.trim();
        if (selectedRating === 0 || feedback === "") {
          alert("Please select a rating and provide your feedback.");
          return;
        }

        const reviewList = document.getElementById('reviewList');
        const li = document.createElement('li');
        li.classList.add('review-item');
        li.innerHTML = `<div class="name">You</div><div>${feedback}</div>`;
        reviewList.prepend(li);

        document.getElementById('feedback').value = '';
        updateStars(0);
        selectedRating = 0;
      }
    </script>

    </div>
  </div>


  <%-include("../partials/footer") %>
